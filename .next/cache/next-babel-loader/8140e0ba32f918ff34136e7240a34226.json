{"ast":null,"code":"import { GoogleSpreadsheet } from 'google-spreadsheet';\nimport credentials from '../../credentials.json';\nimport moment from 'moment';\nconst doc = new GoogleSpreadsheet('1DeqINerc0OuF_yU7fr0hfDUAuspYFjfL4Ju7y1imyYo');\n\nconst genCoupon = () => {\n  const code = parseInt(moment().format('YYMMDDHHmmssSSS')).toString(16).toUpperCase();\n  return code.substr(0, 4) + '-' + code.substr(4, 4) + '-' + code.substr(8, 4);\n};\n\nexport default (async (req, res) => {\n  try {\n    await doc.useServiceAccountAuth({\n      client_email: process.env.SHEET_CLIENT_EMAIL,\n      private_key: process.env.PRIVATE_KEY\n    });\n    await doc.loadInfo();\n    const sheet = doc.sheetsByIndex[1];\n    const data = JSON.parse(req.body);\n    const sheetConfig = doc.sheetsByIndex[2];\n    await sheetConfig.loadCells('A3:B3');\n    const promotionCell = sheetConfig.getCell(2, 0);\n    const textCell = sheetConfig.getCell(2, 1);\n    let coupon = '';\n    let promo = '';\n\n    if (promotionCell.value === \"VERDADEIRO\") {\n      // Gerar cupom\n      coupon = genCoupon();\n      promo = textCell.value;\n    }\n\n    await sheet.addRow({\n      Nome: data.Nome,\n      Email: data.Email,\n      Whatsapp: data.Whatsapp,\n      Nota: parseInt(data.Nota),\n      'Data Preencimento': moment().format('DD/MM/YYYY HH:mm:ss'),\n      Cupom: coupon,\n      Promo: promo\n    });\n    res.end(JSON.stringify({\n      showCoupon: coupon !== \"\",\n      coupon,\n      promo\n    }));\n  } catch (err) {\n    console.log(err);\n    res.end('error');\n  }\n});","map":{"version":3,"sources":["C:/Users/Erika/Desktop/devPleno/palpite-box/pages/api/save.js"],"names":["GoogleSpreadsheet","credentials","moment","doc","genCoupon","code","parseInt","format","toString","toUpperCase","substr","req","res","useServiceAccountAuth","client_email","process","env","SHEET_CLIENT_EMAIL","private_key","PRIVATE_KEY","loadInfo","sheet","sheetsByIndex","data","JSON","parse","body","sheetConfig","loadCells","promotionCell","getCell","textCell","coupon","promo","value","addRow","Nome","Email","Whatsapp","Nota","Cupom","Promo","end","stringify","showCoupon","err","console","log"],"mappings":"AAAA,SAASA,iBAAT,QAAkC,oBAAlC;AACA,OAAOC,WAAP,MAAwB,wBAAxB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,MAAMC,GAAG,GAAG,IAAIH,iBAAJ,CAAsB,8CAAtB,CAAZ;;AAEA,MAAMI,SAAS,GAAG,MAAM;AACpB,QAAMC,IAAI,GAAGC,QAAQ,CAACJ,MAAM,GAAGK,MAAT,CAAgB,iBAAhB,CAAD,CAAR,CAA6CC,QAA7C,CAAsD,EAAtD,EAA0DC,WAA1D,EAAb;AACA,SAAOJ,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAe,CAAf,IAAoB,GAApB,GAA0BL,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAe,CAAf,CAA1B,GAA8C,GAA9C,GAAoDL,IAAI,CAACK,MAAL,CAAY,CAAZ,EAAe,CAAf,CAA3D;AACH,CAHD;;AAKA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC/B,MAAI;AACA,UAAMT,GAAG,CAACU,qBAAJ,CAA0B;AAC5BC,MAAAA,YAAY,EAAEC,OAAO,CAACC,GAAR,CAAYC,kBADE;AAE5BC,MAAAA,WAAW,EAAEH,OAAO,CAACC,GAAR,CAAYG;AAFG,KAA1B,CAAN;AAKA,UAAMhB,GAAG,CAACiB,QAAJ,EAAN;AACA,UAAMC,KAAK,GAAGlB,GAAG,CAACmB,aAAJ,CAAkB,CAAlB,CAAd;AACA,UAAMC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWd,GAAG,CAACe,IAAf,CAAb;AAEA,UAAMC,WAAW,GAAGxB,GAAG,CAACmB,aAAJ,CAAkB,CAAlB,CAApB;AACA,UAAMK,WAAW,CAACC,SAAZ,CAAsB,OAAtB,CAAN;AAEA,UAAMC,aAAa,GAAGF,WAAW,CAACG,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,CAAtB;AACA,UAAMC,QAAQ,GAAGJ,WAAW,CAACG,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,CAAjB;AAEA,QAAIE,MAAM,GAAG,EAAb;AACA,QAAIC,KAAK,GAAG,EAAZ;;AAEA,QAAIJ,aAAa,CAACK,KAAd,KAAwB,YAA5B,EAA0C;AACtC;AACAF,MAAAA,MAAM,GAAG5B,SAAS,EAAlB;AACA6B,MAAAA,KAAK,GAAGF,QAAQ,CAACG,KAAjB;AACH;;AAED,UAAMb,KAAK,CAACc,MAAN,CAAa;AACfC,MAAAA,IAAI,EAAEb,IAAI,CAACa,IADI;AAEfC,MAAAA,KAAK,EAAEd,IAAI,CAACc,KAFG;AAGfC,MAAAA,QAAQ,EAAEf,IAAI,CAACe,QAHA;AAIfC,MAAAA,IAAI,EAAEjC,QAAQ,CAACiB,IAAI,CAACgB,IAAN,CAJC;AAKf,2BAAqBrC,MAAM,GAAGK,MAAT,CAAgB,qBAAhB,CALN;AAMfiC,MAAAA,KAAK,EAAER,MANQ;AAOfS,MAAAA,KAAK,EAAER;AAPQ,KAAb,CAAN;AAUArB,IAAAA,GAAG,CAAC8B,GAAJ,CAAQlB,IAAI,CAACmB,SAAL,CAAe;AACnBC,MAAAA,UAAU,EAAEZ,MAAM,KAAK,EADJ;AAEnBA,MAAAA,MAFmB;AAGnBC,MAAAA;AAHmB,KAAf,CAAR;AAMH,GAzCD,CAyCE,OAAOY,GAAP,EAAY;AACVC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACAjC,IAAAA,GAAG,CAAC8B,GAAJ,CAAQ,OAAR;AACH;AAGJ,CAhDD","sourcesContent":["import { GoogleSpreadsheet } from 'google-spreadsheet'\r\nimport credentials from '../../credentials.json'\r\nimport moment from 'moment'\r\n\r\nconst doc = new GoogleSpreadsheet('1DeqINerc0OuF_yU7fr0hfDUAuspYFjfL4Ju7y1imyYo')\r\n\r\nconst genCoupon = () => {\r\n    const code = parseInt(moment().format('YYMMDDHHmmssSSS')).toString(16).toUpperCase()\r\n    return code.substr(0, 4) + '-' + code.substr(4, 4) + '-' + code.substr(8, 4)\r\n}\r\n\r\nexport default async (req, res) => {\r\n    try {\r\n        await doc.useServiceAccountAuth({\r\n            client_email: process.env.SHEET_CLIENT_EMAIL,\r\n            private_key: process.env.PRIVATE_KEY\r\n        })\r\n\r\n        await doc.loadInfo()\r\n        const sheet = doc.sheetsByIndex[1]\r\n        const data = JSON.parse(req.body)\r\n\r\n        const sheetConfig = doc.sheetsByIndex[2]\r\n        await sheetConfig.loadCells('A3:B3')\r\n\r\n        const promotionCell = sheetConfig.getCell(2, 0)\r\n        const textCell = sheetConfig.getCell(2, 1)\r\n\r\n        let coupon = ''\r\n        let promo = ''\r\n\r\n        if (promotionCell.value === \"VERDADEIRO\") {\r\n            // Gerar cupom\r\n            coupon = genCoupon()\r\n            promo = textCell.value\r\n        }\r\n\r\n        await sheet.addRow({\r\n            Nome: data.Nome,\r\n            Email: data.Email,\r\n            Whatsapp: data.Whatsapp,\r\n            Nota: parseInt(data.Nota),\r\n            'Data Preencimento': moment().format('DD/MM/YYYY HH:mm:ss'),\r\n            Cupom: coupon,\r\n            Promo: promo,\r\n        })\r\n\r\n        res.end(JSON.stringify({\r\n            showCoupon: coupon !== \"\",\r\n            coupon,\r\n            promo\r\n        }))\r\n\r\n    } catch (err) {\r\n        console.log(err)\r\n        res.end('error')\r\n    }\r\n\r\n\r\n}"]},"metadata":{},"sourceType":"module"}